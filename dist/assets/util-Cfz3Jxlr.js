import{o as $,K as z,t as b,E as Y,M as I,u as P,N as O}from"./index-CxQtgwOm.js";import{c as W}from"./index-BwM7Vvlg.js";var j="[object Symbol]";function T(t){return typeof t=="symbol"||$(t)&&z(t)==j}function H(t,e){for(var r=-1,n=t==null?0:t.length,o=Array(n);++r<n;)o[r]=e(t[r],r,t);return o}var A=Y?Y.prototype:void 0,C=A?A.toString:void 0;function R(t){if(typeof t=="string")return t;if(b(t))return H(t,R)+"";if(T(t))return C?C.call(t):"";var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}var V=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,B=/^\w*$/;function K(t,e){if(b(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||T(t)?!0:B.test(t)||!V.test(t)||e!=null&&t in Object(e)}var Z="Expected a function";function k(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(Z);var r=function(){var n=arguments,o=e?e.apply(this,n):n[0],s=r.cache;if(s.has(o))return s.get(o);var c=t.apply(this,n);return r.cache=s.set(o,c)||s,c};return r.cache=new(k.Cache||I),r}k.Cache=I;var G=500;function Q(t){var e=k(t,function(n){return r.size===G&&r.clear(),n}),r=e.cache;return e}var X=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,U=/\\(\\)?/g,q=Q(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(X,function(r,n,o,s){e.push(o?s.replace(U,"$1"):n||r)}),e});function J(t){return t==null?"":R(t)}function x(t,e){return b(t)?t:K(t,e)?[t]:q(J(t))}function v(t){if(typeof t=="string"||T(t))return t;var e=t+"";return e=="0"&&1/t==-1/0?"-0":e}function tt(t,e){e=x(e,t);for(var r=0,n=e.length;t!=null&&r<n;)t=t[v(e[r++])];return r&&r==n?t:void 0}function et(t,e,r){var n=t==null?void 0:tt(t,e);return n===void 0?r:n}const a=window.dayjs,rt=(t="mars",e=11)=>t+"_"+Number(Math.random().toString().substring(2,12)+Date.now()).toString(36).slice(0,e),nt=(t,e)=>{if(!t)return"0.00";const r=parseFloat(t.toString());return isNaN(r)?t:e?r.toLocaleString("zh-CN",{style:e,currency:"CNY"}):r.toLocaleString()},ot=(t,e="YYYY-MM-DD HH:mm:ss")=>t?a(t).format(e):"",st=t=>{const e=new Date;if(t)return t=="today"||(t=="yesterday"&&e.setDate(e.getDate()-1),t=="last7"&&e.setDate(e.getDate()-7),t=="last30"&&e.setMonth(e.getMonth()-1),t=="last90"&&e.setMonth(e.getMonth()-3)),a(e.toLocaleString())},at=t=>{const e=new Date,r=new Date;if(!t)return[void 0,void 0];if(["today","curWeek","curMonth","curYear","curQuarter"].includes(t)){if(t!="today"){if(t=="curWeek")e.setDate(e.getDate()-e.getDay()+1);else if(t=="curMonth")e.setDate(1);else if(t=="curYear")e.setDate(1),e.setMonth(0);else if(t=="curQuarter"){e.setDate(1);const n=e.getMonth();e.setMonth(Math.floor(n/3)*3)}}return[a(e.toLocaleString()),a(r.toLocaleString())]}if(["yesterday","lastWeek","lastMonth","last3Month","lastYear"].includes(t))return t=="yesterday"?e.setDate(e.getDate()-1):t=="lastWeek"?e.setDate(e.getDate()-7):t=="lastMonth"?e.setMonth(e.getMonth()-1):t=="last3Month"?e.setMonth(e.getMonth()-3):t=="lastYear"&&e.setFullYear(e.getFullYear()-1),[a(e.toLocaleString()),a(r.toLocaleString())]},it=t=>t==null,M=t=>!(t===""||t===void 0||t===null);function ct(t){return W(t)}function S(t,e){return t==null?void 0:t.replace(/\$\{([^}]+)\}/g,(r,n)=>{if(n.includes("?"))try{return new Function("param",`return param.${n}`)(e)}catch{return n}return et(e,n)})}function _(t){const e=P.getState().page,r={};return e.variables.forEach(n=>{r[n.name]=e.variableData[n.name]??n.defaultValue}),t?r[t]:r}function L(t,e){const r=e.replace(/^\s*\/\/.*$/gm,"").replace(/\/\*[\s\S]*?\*\//g,"").trim(),n=Array.isArray(t)?t.join(", "):t;if(r.startsWith("function"))return new Function(n,`return ${r};`);const o=r.indexOf("return")>-1?r:`return ${r};`;return new Function(n,o)}function w(t,e={}){try{if(!t)return"";const r=t.match(/([A-Za-z]+_\w+)\.[\w\.]*/g)||[],n=[...new Set(r.map(i=>i.split(".")[0]))],o=["context","eventParams"],{page:s}=P.getState(),c=O(s.formData||{});n.forEach(i=>{var y;const d=((y=s.formData)==null?void 0:y[i])||{};c!=null&&c.id||(c[i]=d)});const l=_(),g=L(o,t),h={variable:l,eventParams:e,FORMAT:(i,d="YYYY-MM-DD HH:mm:ss")=>a(i).format(d),...c},p=g(h,e||{});return typeof p=="function"?p(h,e||{}):p}catch(r){console.error("表达式解析失败：",r)}return""}const E=(t,e)=>{var r;for(let n=0;n<t.length;n++){const o=t[n];["DatePicker","TimePicker","DatePickerRange","TimePickerRange","EditTable"].includes(o.type)?e.push(o.id):(r=o.elements)!=null&&r.length&&E(o.elements,e)}return e},ut=(t,e)=>{const r=P.getState().page.elementsMap;return E(t,[]).map(o=>{var i,d,y,N;const{type:s,config:c}=r[o],{startField:l,endField:g,formItem:{name:u},formWrap:{format:h,columns:p}}=c.props;if(["DatePicker","TimePicker"].includes(s)){if(!e[u])return;e[u]=((d=(i=e[u])==null?void 0:i.format)==null?void 0:d.call(i,h))||a(e[u])}else if(["DatePickerRange","TimePickerRange"].includes(s))if(((y=e[u])==null?void 0:y.length)==2){const[f,D]=((N=e[u])==null?void 0:N.map(m=>{var F;return((F=m==null?void 0:m.format)==null?void 0:F.call(m,h))||a(e[m])}))||[void 0,void 0];l&&g&&(e[l]=f,e[g]=D,delete e[u])}else e[l]&&e[g]&&(e[u]=[a(e[l]),a(e[g])]);else s==="EditTable"&&p.filter(f=>f.type==="date").map(({dataIndex:f})=>{e[u].map(D=>{D[f]&&(D[f]=a(D[f]))})})}),e},ft=(t={},e)=>Object.keys(t).reduce((r,n)=>{const o=t[n];return typeof o=="object"?(o==null?void 0:o.type)==="static"?r[n]=o.value:(o==null?void 0:o.type)==="variable"?r[n]=w(o.value,e):r[n]=o:r[n]=o,r},{}),lt=(t=[],e={})=>t.reduce((r,n)=>{if(n.key)if(typeof n.value=="string")if(M(n.value)){const o=S(n.value,e);r[n.key]=isNaN(o)?o:Number(o)}else r[n.key]=void 0;else if(n.value.type==="static")if(M(n.value.value)){const o=S(n.value.value,e);r[n.key]=isNaN(o)?o:Number(o)}else r[n.key]=void 0;else{const o=w(n.value.value,e);r[n.key]=M(o)?o:void 0}return r},{}),gt=(t,e)=>{if(e)return new Promise((r,n)=>{if(document.getElementById(t))return;const o=document.createElement("link");o.rel="stylesheet",o.type="text/css",o.href=e,o.onload=r,o.onerror=n,o.setAttribute("id",t),document.getElementsByTagName("HEAD")[0].appendChild(o)})},dt=t=>new Promise((e,r)=>{const n=document.createElement("script");n.type="text/javascript",n.defer=!0,n.onload=e,n.onerror=r,n.src=t,document.body.append(n)}),mt=()=>{const t=/^\/editor\/\d+\/edit/.test(location.pathname),e=/^\/page\/(stg|pre|prd)\/\d+/.test(location.pathname),r=/^\/project\/(stg|pre|prd)\/\d+/.test(location.pathname),n=location.pathname.match(/^\/page\/(stg|pre|prd)\/\d+/),o=location.pathname.match(/^\/project\/(stg|pre|prd)\/\d+/),s=n?n[1]:o?o[1]:"stg";return{isDev:t,isPage:e,isProject:r,env:s}},yt=Object.freeze(Object.defineProperty({__proto__:null,copyText:ct,createFunction:L,createId:rt,dateFormat:ut,formatDate:ot,formatNumber:nt,getDateByType:st,getDateItem:E,getDateRangeByType:at,getEnv:mt,getPageVariable:_,handleArrayVariable:lt,handleParamVariable:ft,isNotEmpty:M,isNull:it,loadScript:dt,loadStyle:gt,renderFormula:w,renderTemplate:S},Symbol.toStringTag,{value:"Module"}));export{at as a,tt as b,x as c,ut as d,H as e,it as f,st as g,M as i,gt as l,w as r,v as t,yt as u};

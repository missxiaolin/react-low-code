import{u as H,j as m}from"./index-BGwl3vz8.js";import{g as N}from"./index-B5waRQ5I.js";import{M as P}from"./Render-DFHNfI1Z.js";import{FormContext as k}from"./context-Bq5A5Wbw.js";import{d as p,i as T,g as z,a as _}from"./util-C4LxnPcG.js";import{u as U}from"./useDrop-BijMuSqU.js";import"./useComponentRefs-BjsmN1lJ.js";/* empty css              */import"./isPlainObject-VrXc-4h3.js";import"./index-Bt5bANNj.js";import"./useDragDropManager-DKbTUi75.js";const y=e=>Symbol.iterator in e,x=e=>"entries"in e,g=(e,r)=>{const a=e instanceof Map?e:new Map(e.entries()),s=r instanceof Map?r:new Map(r.entries());if(a.size!==s.size)return!1;for(const[i,c]of a)if(!Object.is(c,s.get(i)))return!1;return!0},$=(e,r)=>{const a=e[Symbol.iterator](),s=r[Symbol.iterator]();let i=a.next(),c=s.next();for(;!i.done&&!c.done;){if(!Object.is(i.value,c.value))return!1;i=a.next(),c=s.next()}return!!i.done&&!!c.done};function q(e,r){return Object.is(e,r)?!0:typeof e!="object"||e===null||typeof r!="object"||r===null?!1:!y(e)||!y(r)?g({entries:()=>Object.entries(e)},{entries:()=>Object.entries(r)}):x(e)&&x(r)?g(e,r):$(e,r)}const v=window.React;function G(e){const r=v.useRef(void 0);return a=>{const s=e(a);return q(r.current,s)?r.current:r.current=s}}const j=window.antd.Form,J=window.React.forwardRef,K=window.React.memo,L=window.React.useCallback,Q=window.React.useImperativeHandle,D=window.React.useState,W=window.dayjs,X=({id:e,type:r,config:a,elements:s,onFinish:i,onChange:c},h)=>{const[l]=j.useForm(),{addChildElements:F,formData:u,setFormData:f}=H(G(t=>({addChildElements:t.addChildElements,formData:t.page.formData,setFormData:t.setFormData}))),[R,w]=D(!0),[E,I]=D({}),[,M]=U({accept:"MENU_ITEM",async drop(t,n){var b;if(n.didDrop())return;const{config:o,events:d,methods:C=[]}=((b=await N(t.type+"Config"))==null?void 0:b.default)||{};F({type:t.type,name:t.name,parentId:e,id:t.id,config:o,events:d,methods:C})},collect:t=>({isOver:t.isOver(),canDrop:t.canDrop()})}),V=t=>{i==null||i(p(s,t))},O=(t,n)=>{const o=p(s,n);c==null||c(o),f({name:e,value:o})};Q(h,()=>({show(){w(!0)},hide(){w(!1)},reset(){l.resetFields(),f({name:e,value:l.getFieldsValue(),type:"override"})},submit(){l.submit()},async validate(){try{return await l.validateFields(),!0}catch(t){return console.error(t),!1}},init(t={}){const n=p(s,t);l.setFieldsValue({...n}),f({name:e,value:{...n},type:"override"})},getFormData(t){var n;return t&&typeof t=="string"?(n=u[e])==null?void 0:n[t]:u[e]}}));const S=L((t,n,o)=>{if(n&&T(o)){let d=o;t==="InputNumber"&&(d=Number(o)),t==="DatePicker"&&(d=z(o)),t==="DatePickerRange"&&(d=_(o)),t==="TimePicker"&&(d=W(o,"HH:mm:ss")),I({[n]:d}),l.setFieldValue([n],d),f({name:e,value:{[n]:d}})}},[]);return R&&m.jsx(k.Provider,{value:{initValues:S},children:m.jsx("div",{ref:M,children:m.jsx(j,{form:l,style:a.style,...a.props,"data-id":e,"data-type":r,initialValues:E,onFinish:V,onValuesChange:O,children:s.length?m.jsx(P,{elements:s}):m.jsx("div",{className:"slots",style:{lineHeight:"150px"},children:"拖拽表单组件到这里"})})})})},ie=K(J(X));export{ie as default};

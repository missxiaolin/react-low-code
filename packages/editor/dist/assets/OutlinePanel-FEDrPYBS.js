import{u as I,j as u,M as P,a as g}from"./index-Co7b-eGp.js";import{u as T}from"./shallow-CCaxSZAj.js";import{s as k}from"./index-BPZUQkiK.js";import"./index-BqC4hqLw.js";import"./useDragDropManager-WNxthqwr.js";const M=window.React.memo,O=window.React.useEffect,b=window.React.useMemo,v=window.React.useState,K=window.antd.Tree,A=window.antd.Row,C=window.icons.DownOutlined,B=M(()=>{const{pageName:f,elements:r,selectedEl:m,setSelectedElement:p,dragSortElements:y}=I(T(e=>({pageName:e.page.pageName,elements:e.page.elements,selectedEl:e.selectedElement,setSelectedElement:e.setSelectedElement,dragSortElements:e.dragSortElements}))),[E,i]=v([]),S=b(()=>[{type:`页面【${f}】`,id:"page",elements:r}],[r]);O(()=>{i(m?[m.id]:[])},[m]);const h=(e,{node:n})=>{i(e),e.length>0?e[0]==="page"?p(void 0):p({id:n.id,type:n.type}):p(void 0)},x=e=>{console.log(e);const{key:n,type:N,name:R,elements:j}=e.dragNode,{key:o}=e.node,w=e.node.pos.split("-"),D=e.dropPosition-Number(w[w.length-1]),l=P(r),a=g(l,n);a&&a.elements&&a.elements.splice(a.index,1);const c={id:n,type:N,name:R,elements:j};let d=null;if(e.dropToGap){const{index:t,elements:s}=g(l,o)||{index:0};d=s[t].parentId,D===-1?s==null||s.splice(t,0,{...c,parentId:d}):s==null||s.splice(t+1,0,{...c,parentId:d})}else if(o=="page")l.unshift(c);else{const{element:t}=g(l,o);t&&(d=o,t.elements=t.elements||[],t.elements.unshift({...c,parentId:o}))}y({id:n,list:l,parentId:d}),i([])};return u.jsx(A,{className:k["outline-panel"],children:u.jsx(K,{showLine:!0,defaultExpandAll:!0,draggable:!0,switcherIcon:u.jsx(C,{}),fieldNames:{title:"type",key:"id",children:"elements"},treeData:S,selectedKeys:E,onSelect:h,onDrop:x,style:{width:"100%"}})})});export{B as default};

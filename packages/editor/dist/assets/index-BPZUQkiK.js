const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/OutlinePanel-FEDrPYBS.js","assets/index-Co7b-eGp.js","assets/index-DaP79Pgd.css","assets/shallow-CCaxSZAj.js","assets/index-BqC4hqLw.js","assets/index-Cxj_b0qa.css","assets/useDragDropManager-WNxthqwr.js","assets/CodingPanel-CntuKJmT.js","assets/index-Cd8mrToj.js","assets/VariableList-CTX4G4dQ.js"])))=>i.map(i=>d[i]);
import{i as v,u as K,c as S,j as n,b as B,m as V,e as k,S as Y,_ as M}from"./index-Co7b-eGp.js";import{g as E}from"./index-BqC4hqLw.js";import{s as A,w as Q,i as F,u as R,a as j,r as q,b as G,c as J}from"./useDragDropManager-WNxthqwr.js";const $=window.React.useMemo;function W(i){return $(()=>i.hooks.dragSource(),[i])}function X(i){return $(()=>i.hooks.dragPreview(),[i])}let I=!1,O=!1;class Z{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){v(!I,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return I=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{I=!1}}isDragging(){if(!this.sourceId)return!1;v(!O,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return O=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{O=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class ee{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,r=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(r&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}r&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!A(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!A(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Q({dragSource:(t,r)=>{this.clearDragSource(),this.dragSourceOptions=r||null,F(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,r)=>{this.clearDragPreview(),this.dragPreviewOptions=r||null,F(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}const te=window.React.useMemo;function ne(i,e){const t=R(),r=te(()=>new ee(t.getBackend()),[t]);return j(()=>(r.dragSourceOptions=i||null,r.reconnect(),()=>r.disconnectDragSource()),[r,i]),j(()=>(r.dragPreviewOptions=e||null,r.reconnect(),()=>r.disconnectDragPreview()),[r,e]),r}const re=window.React.useMemo;function ie(){const i=R();return re(()=>new Z(i),[i])}class se{beginDrag(){const e=this.spec,t=this.monitor;let r=null;return typeof e.item=="object"?r=e.item:typeof e.item=="function"?r=e.item(t):r={},r??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const r=this.spec,o=this.monitor,{isDragging:l}=r;return l?l(o):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,r=this.connector,{end:o}=e;o&&o(t.getItem(),t),r.reconnect()}constructor(e,t,r){this.spec=e,this.monitor=t,this.connector=r}}const oe=window.React.useEffect,ae=window.React.useMemo;function ce(i,e,t){const r=ae(()=>new se(i,e,t),[e,t]);return oe(()=>{r.spec=i},[i]),r}const de=window.React.useMemo;function le(i){return de(()=>{const e=i.type;return v(e!=null,"spec.type must be defined"),e},[i])}function ue(i,e,t){const r=R(),o=ce(i,e,t),l=le(i);j(function(){if(l!=null){const[h,w]=q(l,o,r);return e.receiveHandlerId(h),t.receiveHandlerId(h),w}},[r,e,t,o,l])}function ge(i,e){const t=G(i,e);v(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const r=ie(),o=ne(t.options,t.previewOptions);return ue(t,r,o),[J(t.collect,r,o),W(o),X(o)]}const he=window.antd.Button,pe=window.React.useState;function fe(i){const{addElement:e,selectedElement:t,page:r,addChildElements:o}=K(d=>d),{elementsMap:l}=r,[g,h]=pe(S(i.type)),[{isDragging:w},C]=ge(()=>({type:"MENU_ITEM",item:{id:g,type:i.type,name:i.name},end:()=>{h(S(i.type))},collect:d=>({isDragging:d.isDragging()})}),[g]),m=async d=>{var f;const{config:D,events:s,methods:a=[],elements:u=[]}=((f=await E(d.type+"Config"))==null?void 0:f.default)||{},p=S(d.type);if(!B(d.type,t==null?void 0:t.id,t==null?void 0:t.type,l)){V.info("请把表单项放在Form容器内");return}const b=u.map(async c=>{var T;const{config:P,events:L,methods:z=[]}=((T=await E(c.type+"Config"))==null?void 0:T.default)||{};return{id:c.id||S(c.type),name:c.name,type:c.type,parentId:p,config:P,events:L,methods:z}})||[];Promise.all(b).then(c=>{t?o({type:d.type,name:d.name,elements:c,parentId:t.id,id:p,config:D,events:s,methods:a}):e({type:d.type,name:d.name,id:p,elements:c,config:D,events:s,methods:a})})};return n.jsx(he,{type:"default",block:!0,ref:C,onClick:()=>m(i),children:i.name})}const we=window.React.useEffect,me=window.React.useMemo,y=window.React.useState,De=window.antd.Tabs,Se=window.antd.Collapse,x=window.antd.Empty,ye=window.antd.Col,ve=window.antd.Row,Ce=window.antd.Input,be=window.antd.Divider,Pe=window.ahooks.useDebounceFn,Ie=window.icons.SearchOutlined,Oe=window.icons.UpOutlined;function xe(){const[i,e]=y([]),[t,r]=y("system"),[o,l]=y([]),[g,h]=y("");we(()=>{const s=(g?w(k,g):k).filter(a=>!a.hidden).map(a=>({key:a.type,label:a.title,children:n.jsx(ve,{gutter:[10,10],children:a.data.filter(u=>!u.hidden).map(u=>n.jsx(ye,{span:12,children:n.jsx(fe,{...u})},u.type))})}));e(s.map(a=>a.key)),l(s)},[g]);function w(s,a){const u=[];function p(b,f){for(const c of b)if(Array.isArray(c.data))p(c.data,{...c,data:[]});else if(c.name.includes(a)){if(f.data.push(c),u.filter(P=>P.type===f.type).length>0)continue;u.push({...f})}}return a?(p(s,null),u):s}const C=s=>{e(typeof s=="string"?[s]:s)},m=me(()=>[{key:"system",label:"系统组件",children:n.jsxs(n.Fragment,{children:[n.jsx(Se,{style:{height:o.length>0?"calc(100vh - 210px)":"",overflowY:"auto"},items:o,ghost:!0,expandIconPosition:"end",size:"small",activeKey:i,onChange:C,expandIcon:({isActive:s})=>n.jsx(Oe,{rotate:s?0:-180})}),o.length===0&&n.jsx(x,{image:x.PRESENTED_IMAGE_SIMPLE})]})},{key:"custom",label:"自定义组件",children:n.jsx(x,{})}],[o,i]),{run:d}=Pe(s=>{const a=s.target.value;h(a)},{wait:500}),D=s=>{r(s)};return n.jsx(De,{size:"small",defaultActiveKey:m[0].key,tabPosition:"top",onChange:D,items:m.map(s=>({key:s.key,label:s.label,children:n.jsxs(n.Fragment,{children:[t==="system"&&n.jsxs(n.Fragment,{children:[n.jsx(Ce,{placeholder:"输入组件名称查询",suffix:n.jsx(Ie,{}),onChange:d}),n.jsx(be,{style:{margin:"12px 0 0 0"}})]}),s.children]})}))})}const je={"left-tool":"_left-tool_104oz_1","outline-panel":"_outline-panel_104oz_5"},Me=window.antd.Col,Re=window.antd.Row,_e=window.antd.Tabs,H=window.antd.Tooltip,N=window.antd.Space,Te=window.icons.AppstoreOutlined,U=window.icons.QuestionCircleOutlined,ke=window.icons.PartitionOutlined,Ee=window.icons.CodeOutlined,Ae=window.icons.FunctionOutlined,Fe=window.React.Suspense,_=window.React.lazy,He=_(()=>M(()=>import("./OutlinePanel-FEDrPYBS.js"),__vite__mapDeps([0,1,2,3,4,5,6]))),Ne=_(()=>M(()=>import("./CodingPanel-CntuKJmT.js"),__vite__mapDeps([7,1,2,8]))),Ue=_(()=>M(()=>import("./VariableList-CTX4G4dQ.js"),__vite__mapDeps([9,1,2,8])));function $e(){const i=[{key:"ComponentPanel",icon:n.jsx(Te,{}),label:"组件",title:n.jsxs(N,{children:[n.jsx("span",{children:"组件物料"}),n.jsx(H,{title:"无需拖拽，直接点击就能添加到画布中。",children:n.jsx(U,{})})]}),component:()=>n.jsx(xe,{})},{key:"OutlinePanel",icon:n.jsx(ke,{}),label:"大纲",title:n.jsxs(N,{children:[n.jsx("span",{children:"页面大纲"}),n.jsx(H,{title:"组件支持拖拽排序",children:n.jsx(U,{})})]}),component:()=>n.jsx(He,{})},{key:"CodingPanel",icon:n.jsx(Ee,{}),label:"源码",title:n.jsx("span",{children:"页面JSON"}),component:()=>n.jsx(Ne,{})},{key:"Variable",icon:n.jsx(Ae,{}),label:"变量",title:n.jsx("span",{children:"页面变量"}),component:()=>n.jsx(Ue,{})}];return n.jsx(n.Fragment,{children:n.jsx(_e,{size:"small",defaultActiveKey:i[0].key,tabPosition:"left",tabBarStyle:{width:"50px",height:"calc(100vh - 64px)"},className:je["left-tool"],centered:!0,items:i.map(e=>{var t;return{key:e.key,label:n.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[n.jsx("div",{children:e.icon}),n.jsx("div",{children:e.label})]}),children:n.jsxs("div",{style:{marginLeft:-10,marginRight:10},children:[n.jsx(Re,{style:{height:46},align:"middle",justify:"space-between",children:n.jsx(Me,{children:n.jsx("span",{style:{fontWeight:"bold"},children:e.title})})}),n.jsx(Fe,{fallback:n.jsx(Y,{}),children:(t=e.component)==null?void 0:t.call(e)})]})}})})})}const Be=Object.freeze(Object.defineProperty({__proto__:null,default:$e},Symbol.toStringTag,{value:"Module"}));export{Be as i,je as s};

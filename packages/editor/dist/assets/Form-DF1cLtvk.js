import{u as I,j as n}from"./index-Co7b-eGp.js";import{u as H}from"./shallow-CCaxSZAj.js";import{g as M}from"./index-BqC4hqLw.js";import{M as N}from"./Render-BFQiaP3j.js";import{FormContext as P}from"./context-t8a8ywtA.js";import{d as c,i as S,g as T,a as k}from"./util-D_3K64tU.js";import{u as B}from"./useDrop-DlwKLMqZ.js";import"./useComponentRefs-BjsmN1lJ.js";/* empty css              */import"./isPlainObject-CKAOE8ju.js";import"./index-BmnTL83M.js";import"./useDragDropManager-WNxthqwr.js";const D=window.antd.Form,O=window.React.forwardRef,_=window.React.memo,U=window.React.useCallback,$=window.React.useImperativeHandle,g=window.React.useState,q=window.dayjs,z=({id:s,type:y,config:u,elements:i,onFinish:l,onChange:m},v)=>{const[o]=D.useForm(),{addChildElements:F,formData:p,setFormData:d}=I(H(e=>({addChildElements:e.addChildElements,formData:e.page.formData,setFormData:e.setFormData}))),[h,f]=g(!0),[R,x]=g({}),[,j]=B({accept:"MENU_ITEM",async drop(e,t){var w;if(t.didDrop())return;const{config:a,events:r,methods:C=[]}=((w=await M(e.type+"Config"))==null?void 0:w.default)||{};F({type:e.type,name:e.name,parentId:s,id:e.id,config:a,events:r,methods:C})},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop()})}),V=e=>{l==null||l(c(i,e))},b=(e,t)=>{const a=c(i,t);m==null||m(a),d({name:s,value:a})};$(v,()=>({show(){f(!0)},hide(){f(!1)},reset(){o.resetFields(),d({name:s,value:o.getFieldsValue(),type:"override"})},submit(){o.submit()},async validate(){try{return await o.validateFields(),!0}catch(e){return console.error(e),!1}},init(e={}){const t=c(i,e);o.setFieldsValue({...t}),d({name:s,value:{...t},type:"override"})},getFormData(e){var t;return e&&typeof e=="string"?(t=p[s])==null?void 0:t[e]:p[s]}}));const E=U((e,t,a)=>{if(t&&S(a)){let r=a;e==="InputNumber"&&(r=Number(a)),e==="DatePicker"&&(r=T(a)),e==="DatePickerRange"&&(r=k(a)),e==="TimePicker"&&(r=q(a,"HH:mm:ss")),x({[t]:r}),o.setFieldValue([t],r),d({name:s,value:{[t]:r}})}},[]);return h&&n.jsx(P.Provider,{value:{initValues:E},children:n.jsx("div",{ref:j,children:n.jsx(D,{form:o,style:u.style,...u.props,"data-id":s,"data-type":y,initialValues:R,onFinish:V,onValuesChange:b,children:i.length?n.jsx(N,{elements:i}):n.jsx("div",{className:"slots",style:{lineHeight:"150px"},children:"拖拽表单组件到这里"})})})})},ae=_(O(z));export{ae as default};

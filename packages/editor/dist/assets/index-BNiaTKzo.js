import{i as C,u as _,c as S,j as r,b as B,m as L,e as T,S as z}from"./index-BGwl3vz8.js";import{g as k}from"./index-B5waRQ5I.js";import{s as E,w as Y,i as H,u as j,a as M,r as Q,b as q,c as G}from"./useDragDropManager-DKbTUi75.js";const F=window.React.useMemo;function W(i){return F(()=>i.hooks.dragSource(),[i])}function J(i){return F(()=>i.hooks.dragPreview(),[i])}let P=!1,O=!1;class V{receiveHandlerId(e){this.sourceId=e}getHandlerId(){return this.sourceId}canDrag(){C(!P,"You may not call monitor.canDrag() inside your canDrag() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return P=!0,this.internalMonitor.canDragSource(this.sourceId)}finally{P=!1}}isDragging(){if(!this.sourceId)return!1;C(!O,"You may not call monitor.isDragging() inside your isDragging() implementation. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source-monitor");try{return O=!0,this.internalMonitor.isDraggingSource(this.sourceId)}finally{O=!1}}subscribeToStateChange(e,t){return this.internalMonitor.subscribeToStateChange(e,t)}isDraggingSource(e){return this.internalMonitor.isDraggingSource(e)}isOverTarget(e,t){return this.internalMonitor.isOverTarget(e,t)}getTargetIds(){return this.internalMonitor.getTargetIds()}isSourcePublic(){return this.internalMonitor.isSourcePublic()}getSourceId(){return this.internalMonitor.getSourceId()}subscribeToOffsetChange(e){return this.internalMonitor.subscribeToOffsetChange(e)}canDragSource(e){return this.internalMonitor.canDragSource(e)}canDropOnTarget(e){return this.internalMonitor.canDropOnTarget(e)}getItemType(){return this.internalMonitor.getItemType()}getItem(){return this.internalMonitor.getItem()}getDropResult(){return this.internalMonitor.getDropResult()}didDrop(){return this.internalMonitor.didDrop()}getInitialClientOffset(){return this.internalMonitor.getInitialClientOffset()}getInitialSourceClientOffset(){return this.internalMonitor.getInitialSourceClientOffset()}getSourceClientOffset(){return this.internalMonitor.getSourceClientOffset()}getClientOffset(){return this.internalMonitor.getClientOffset()}getDifferenceFromInitialOffset(){return this.internalMonitor.getDifferenceFromInitialOffset()}constructor(e){this.sourceId=null,this.internalMonitor=e.getMonitor()}}class X{receiveHandlerId(e){this.handlerId!==e&&(this.handlerId=e,this.reconnect())}get connectTarget(){return this.dragSource}get dragSourceOptions(){return this.dragSourceOptionsInternal}set dragSourceOptions(e){this.dragSourceOptionsInternal=e}get dragPreviewOptions(){return this.dragPreviewOptionsInternal}set dragPreviewOptions(e){this.dragPreviewOptionsInternal=e}reconnect(){const e=this.reconnectDragSource();this.reconnectDragPreview(e)}reconnectDragSource(){const e=this.dragSource,t=this.didHandlerIdChange()||this.didConnectedDragSourceChange()||this.didDragSourceOptionsChange();return t&&this.disconnectDragSource(),this.handlerId?e?(t&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragSource=e,this.lastConnectedDragSourceOptions=this.dragSourceOptions,this.dragSourceUnsubscribe=this.backend.connectDragSource(this.handlerId,e,this.dragSourceOptions)),t):(this.lastConnectedDragSource=e,t):t}reconnectDragPreview(e=!1){const t=this.dragPreview,n=e||this.didHandlerIdChange()||this.didConnectedDragPreviewChange()||this.didDragPreviewOptionsChange();if(n&&this.disconnectDragPreview(),!!this.handlerId){if(!t){this.lastConnectedDragPreview=t;return}n&&(this.lastConnectedHandlerId=this.handlerId,this.lastConnectedDragPreview=t,this.lastConnectedDragPreviewOptions=this.dragPreviewOptions,this.dragPreviewUnsubscribe=this.backend.connectDragPreview(this.handlerId,t,this.dragPreviewOptions))}}didHandlerIdChange(){return this.lastConnectedHandlerId!==this.handlerId}didConnectedDragSourceChange(){return this.lastConnectedDragSource!==this.dragSource}didConnectedDragPreviewChange(){return this.lastConnectedDragPreview!==this.dragPreview}didDragSourceOptionsChange(){return!E(this.lastConnectedDragSourceOptions,this.dragSourceOptions)}didDragPreviewOptionsChange(){return!E(this.lastConnectedDragPreviewOptions,this.dragPreviewOptions)}disconnectDragSource(){this.dragSourceUnsubscribe&&(this.dragSourceUnsubscribe(),this.dragSourceUnsubscribe=void 0)}disconnectDragPreview(){this.dragPreviewUnsubscribe&&(this.dragPreviewUnsubscribe(),this.dragPreviewUnsubscribe=void 0,this.dragPreviewNode=null,this.dragPreviewRef=null)}get dragSource(){return this.dragSourceNode||this.dragSourceRef&&this.dragSourceRef.current}get dragPreview(){return this.dragPreviewNode||this.dragPreviewRef&&this.dragPreviewRef.current}clearDragSource(){this.dragSourceNode=null,this.dragSourceRef=null}clearDragPreview(){this.dragPreviewNode=null,this.dragPreviewRef=null}constructor(e){this.hooks=Y({dragSource:(t,n)=>{this.clearDragSource(),this.dragSourceOptions=n||null,H(t)?this.dragSourceRef=t:this.dragSourceNode=t,this.reconnectDragSource()},dragPreview:(t,n)=>{this.clearDragPreview(),this.dragPreviewOptions=n||null,H(t)?this.dragPreviewRef=t:this.dragPreviewNode=t,this.reconnectDragPreview()}}),this.handlerId=null,this.dragSourceRef=null,this.dragSourceOptionsInternal=null,this.dragPreviewRef=null,this.dragPreviewOptionsInternal=null,this.lastConnectedHandlerId=null,this.lastConnectedDragSource=null,this.lastConnectedDragSourceOptions=null,this.lastConnectedDragPreview=null,this.lastConnectedDragPreviewOptions=null,this.backend=e}}const Z=window.React.useMemo;function ee(i,e){const t=j(),n=Z(()=>new X(t.getBackend()),[t]);return M(()=>(n.dragSourceOptions=i||null,n.reconnect(),()=>n.disconnectDragSource()),[n,i]),M(()=>(n.dragPreviewOptions=e||null,n.reconnect(),()=>n.disconnectDragPreview()),[n,e]),n}const te=window.React.useMemo;function ne(){const i=j();return te(()=>new V(i),[i])}class re{beginDrag(){const e=this.spec,t=this.monitor;let n=null;return typeof e.item=="object"?n=e.item:typeof e.item=="function"?n=e.item(t):n={},n??null}canDrag(){const e=this.spec,t=this.monitor;return typeof e.canDrag=="boolean"?e.canDrag:typeof e.canDrag=="function"?e.canDrag(t):!0}isDragging(e,t){const n=this.spec,o=this.monitor,{isDragging:l}=n;return l?l(o):t===e.getSourceId()}endDrag(){const e=this.spec,t=this.monitor,n=this.connector,{end:o}=e;o&&o(t.getItem(),t),n.reconnect()}constructor(e,t,n){this.spec=e,this.monitor=t,this.connector=n}}const ie=window.React.useEffect,se=window.React.useMemo;function oe(i,e,t){const n=se(()=>new re(i,e,t),[e,t]);return ie(()=>{n.spec=i},[i]),n}const ae=window.React.useMemo;function ce(i){return ae(()=>{const e=i.type;return C(e!=null,"spec.type must be defined"),e},[i])}function de(i,e,t){const n=j(),o=oe(i,e,t),l=ce(i);M(function(){if(l!=null){const[h,w]=Q(l,o,n);return e.receiveHandlerId(h),t.receiveHandlerId(h),w}},[n,e,t,o,l])}function le(i,e){const t=q(i,e);C(!t.begin,"useDrag::spec.begin was deprecated in v14. Replace spec.begin() with spec.item(). (see more here - https://react-dnd.github.io/react-dnd/docs/api/use-drag)");const n=ne(),o=ee(t.options,t.previewOptions);return de(t,n,o),[G(t.collect,n,o),W(o),J(o)]}const ue=window.antd.Button,ge=window.React.useState;function he(i){const{addElement:e,selectedElement:t,page:n,addChildElements:o}=_(d=>d),{elementsMap:l}=n,[g,h]=ge(S(i.type)),[{isDragging:w},v]=le(()=>({type:"MENU_ITEM",item:{id:g,type:i.type,name:i.name},end:()=>{h(S(i.type))},collect:d=>({isDragging:d.isDragging()})}),[g]),m=async d=>{var f;const{config:D,events:s,methods:a=[],elements:u=[]}=((f=await k(d.type+"Config"))==null?void 0:f.default)||{},p=S(d.type);if(!B(d.type,t==null?void 0:t.id,t==null?void 0:t.type,l)){L.info("请把表单项放在Form容器内");return}const I=u.map(async c=>{var R;const{config:b,events:A,methods:K=[]}=((R=await k(c.type+"Config"))==null?void 0:R.default)||{};return{id:c.id||S(c.type),name:c.name,type:c.type,parentId:p,config:b,events:A,methods:K}})||[];Promise.all(I).then(c=>{t?o({type:d.type,name:d.name,elements:c,parentId:t.id,id:p,config:D,events:s,methods:a}):e({type:d.type,name:d.name,id:p,elements:c,config:D,events:s,methods:a})})};return r.jsx(ue,{type:"default",block:!0,ref:v,onClick:()=>m(i),children:i.name})}const pe=window.React.useEffect,fe=window.React.useMemo,y=window.React.useState,we=window.antd.Tabs,me=window.antd.Collapse,x=window.antd.Empty,De=window.antd.Col,Se=window.antd.Row,ye=window.antd.Input,Ce=window.antd.Divider,ve=window.ahooks.useDebounceFn,Ie=window.icons.SearchOutlined,be=window.icons.UpOutlined;function Pe(){const[i,e]=y([]),[t,n]=y("system"),[o,l]=y([]),[g,h]=y("");pe(()=>{const s=(g?w(T,g):T).filter(a=>!a.hidden).map(a=>({key:a.type,label:a.title,children:r.jsx(Se,{gutter:[10,10],children:a.data.filter(u=>!u.hidden).map(u=>r.jsx(De,{span:12,children:r.jsx(he,{...u})},u.type))})}));e(s.map(a=>a.key)),l(s)},[g]);function w(s,a){const u=[];function p(I,f){for(const c of I)if(Array.isArray(c.data))p(c.data,{...c,data:[]});else if(c.name.includes(a)){if(f.data.push(c),u.filter(b=>b.type===f.type).length>0)continue;u.push({...f})}}return a?(p(s,null),u):s}const v=s=>{e(typeof s=="string"?[s]:s)},m=fe(()=>[{key:"system",label:"系统组件",children:r.jsxs(r.Fragment,{children:[r.jsx(me,{style:{height:o.length>0?"calc(100vh - 210px)":"",overflowY:"auto"},items:o,ghost:!0,expandIconPosition:"end",size:"small",activeKey:i,onChange:v,expandIcon:({isActive:s})=>r.jsx(be,{rotate:s?0:-180})}),o.length===0&&r.jsx(x,{image:x.PRESENTED_IMAGE_SIMPLE})]})},{key:"custom",label:"自定义组件",children:r.jsx(x,{})}],[o,i]),{run:d}=ve(s=>{const a=s.target.value;h(a)},{wait:500}),D=s=>{n(s)};return r.jsx(we,{size:"small",defaultActiveKey:m[0].key,tabPosition:"top",onChange:D,items:m.map(s=>({key:s.key,label:s.label,children:r.jsxs(r.Fragment,{children:[t==="system"&&r.jsxs(r.Fragment,{children:[r.jsx(ye,{placeholder:"输入组件名称查询",suffix:r.jsx(Ie,{}),onChange:d}),r.jsx(Ce,{style:{margin:"12px 0 0 0"}})]}),s.children]})}))})}const Oe={"left-tool":"_left-tool_104oz_1"},xe=window.antd.Col,Me=window.antd.Row,je=window.antd.Tabs,N=window.antd.Tooltip,U=window.antd.Space,Re=window.antd.Empty,Te=window.icons.AppstoreOutlined,$=window.icons.QuestionCircleOutlined,ke=window.icons.PartitionOutlined,Ee=window.React.Suspense;function $e(){const i=[{key:"ComponentPanel",icon:r.jsx(Te,{}),label:"组件",title:r.jsxs(U,{children:[r.jsx("span",{children:"组件物料"}),r.jsx(N,{title:"无需拖拽，直接点击就能添加到画布中。",children:r.jsx($,{})})]}),component:()=>r.jsx(Pe,{})},{key:"OutlinePanel",icon:r.jsx(ke,{}),label:"大纲",title:r.jsxs(U,{children:[r.jsx("span",{children:"页面大纲"}),r.jsx(N,{title:"组件支持拖拽排序",children:r.jsx($,{})})]}),component:()=>r.jsx(Re,{})}];return r.jsx(r.Fragment,{children:r.jsx(je,{size:"small",defaultActiveKey:i[0].key,tabPosition:"left",tabBarStyle:{width:"50px",height:"calc(100vh - 64px)"},className:Oe["left-tool"],centered:!0,items:i.map(e=>{var t;return{key:e.key,label:r.jsxs("div",{style:{display:"flex",flexDirection:"column",justifyContent:"flex-end"},children:[r.jsx("div",{children:e.icon}),r.jsx("div",{children:e.label})]}),children:r.jsxs("div",{style:{marginLeft:-10,marginRight:10},children:[r.jsx(Me,{style:{height:46},align:"middle",justify:"space-between",children:r.jsx(xe,{children:r.jsx("span",{style:{fontWeight:"bold"},children:e.title})})}),r.jsx(Ee,{fallback:r.jsx(z,{}),children:(t=e.component)==null?void 0:t.call(e)})]})}})})})}export{$e as default};

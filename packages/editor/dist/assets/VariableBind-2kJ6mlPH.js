import{u as R,a as I,M as O,j as e}from"./index-BAo4Jr3B.js";import{V as T}from"./VsEditor-oLE867p6.js";const A="_container_1v0q9_1",M="_leftFn_1v0q9_6",E="_box_1v0q9_23",P="_content_1v0q9_27",q="_title_1v0q9_30",D="_variable_1v0q9_38",u={container:A,leftFn:M,box:E,content:P,title:q,variable:D},j=window.antd.Button,L=window.antd.Collapse,V=window.antd.Form,B=window.antd.Modal,W=window.antd.Popover,H=window.antd.Tree,Q=window.React.forwardRef,G=window.React.memo,K=window.React.useCallback,z=window.React.useImperativeHandle,J=window.React.useState,U=window.icons.DownOutlined,X=window.icons.NotificationOutlined,Y=window.icons.QuestionCircleOutlined,Z=({onSelect:d},h)=>{const[y,m]=J(!1),[s]=V.useForm(),{page:w}=R(r=>r),{variables:i,pageName:c,elements:p,elementsMap:x}=w,g=K(()=>{const r=[];return Object.keys(x).map(t=>{var l;if(t.startsWith("SearchForm_")||t.startsWith("Form_")||t.startsWith("GridForm_")||t.startsWith("MarsTable_")){const{element:a}=I(O(p),t);if(!a)return;(l=a.elements)==null||l.map(o=>{var f;const n=(f=x[o.id])==null?void 0:f.config.props.formItem;n?o.name=`${n.label}(${n.name})`:o.name=""}),a.elements&&(a.elements=a.elements.filter(o=>o.name)),r.push(a)}}),r},[x,p]);function k(r){return r.map(t=>{const{name:l,type:a,defaultValue:o}=t,n={name:l,value:o,elements:[]};return a==="array"?(n.type="Variable",n.id=t.name,n.name=`Array<${t.name}>${t.remark?"("+t.remark+")":""}`):a==="object"?(n.id=t.name,n.name=`${t.name}${t.remark?"("+t.remark+")":""}`,n.type="Variable",n.elements=k(Object.entries(o).map(([f,F])=>({type:Array.isArray(F)?"array":typeof F,id:t.name+"."+f,name:t.name+"."+f,defaultValue:F})))):(n.type="Variable",n.id=t.name,n.name=`${t.name}${t.remark?"("+t.remark+")":""}`),n})}const $=[{name:`页面【${c}】`,id:"page",elements:[{name:"系统变量",id:"SystemVariable",type:"SystemVariable",elements:[{type:"Store",id:"userId",name:"userId"},{type:"Store",id:"userName",name:"userName"}]},{name:"全局变量",id:"PageVariable",type:"PageVariable",elements:k(i)},...g()]}];z(h,()=>({open(r){s.setFieldValue("expression",r),m(!0)}}));const b=r=>{r==="boolean"&&s.setFieldValue("expression","true"),r==="table"?s.setFieldValue("expression",`function render(text, record, index) {
    return text;
}`):r==="expression"?s.setFieldValue("expression","status === 1 ? '启用' : '禁用'"):r==="function"&&s.setFieldValue("expression",`function run() {
    return context.eventParams;
}`)},S=(r,{node:t})=>{var a,o;if(!t.type)return;const l=s.getFieldValue("expression")??"";if(t.type==="Store"){s.setFieldValue("expression",`${l} context.store.${t.id}`.trimStart());return}if(t.type==="Variable"){s.setFieldValue("expression",`${l} context.variable.${t.id}`.trimStart());return}if(t.type==="PageVariable")s.setFieldValue("expression",`${l} context.variable`);else if(t.type==="EditTable"){const n=(a=x[t.id])==null?void 0:a.config.props.field;n&&s.setFieldValue("expression",`${l} context.${t.parentId}.${n}`.trimStart())}else if(t.type==="Form"||t.type==="SearchForm")s.setFieldValue("expression",`${l}  context.${t.id}`);else{const n=(o=x[t.id])==null?void 0:o.config.props.formItem;s.setFieldValue("expression",`${l} context.${t.parentId}.${n.name}`.trimStart())}},_=r=>{const t=s.getFieldValue("expression")??"";s.setFieldValue("expression",`${t} context.${r}()`.trimStart())},C=()=>{const r=s.getFieldValue("expression");d({value:r}),v()},v=()=>{m(!1)},N=[{key:"1",label:"逻辑函数",children:null},{key:"2",label:"数学函数",children:null},{key:"3",label:"日期函数",children:e.jsx("ul",{children:e.jsx("li",{onClick:()=>_("FORMAT"),children:"FORMAT"})})},{key:"4",label:"数组函数",children:null}];return e.jsxs(B,{open:y,onCancel:v,title:"逻辑编辑器",width:1100,onOk:C,okText:"确认",cancelText:"取消",children:[e.jsxs("div",{style:{marginBlock:10},children:[e.jsx(X,{style:{color:"#7D33FF"}}),e.jsx("span",{style:{marginLeft:5},children:"下表为页面定义的全局变量，选择时，直接鼠标点击对应的行即可。"})]}),e.jsxs("div",{className:u.container,children:[e.jsxs("div",{className:u.leftFn,children:[e.jsx("div",{className:u.title,children:"计算函数"}),e.jsx("div",{className:u.box,children:e.jsx(L,{ghost:!0,items:N,style:{marginTop:-13}})})]}),e.jsxs("div",{className:u.content,children:[e.jsxs("div",{className:u.title,children:["表达式",e.jsx(W,{content:e.jsxs("div",{children:[e.jsxs("p",{children:["1. 默认支持普通变量定义，最终会返回该解析后的变量值：variable.current"," "]}),e.jsx("p",{children:"2. 支持三元表达式：userName === 'jack' ? 1 : 2 "}),e.jsx("p",{children:"2. 支持布尔值：true ，最终会被解析会true变量进行返回。"}),e.jsxs("p",{children:["3. 支持逻辑判断：if( a ",">"," 1 ) return 1; return 2 "]}),e.jsxs("p",{children:["4. 支持函数function定义：function getName()",'{ return "jack" } ']}),e.jsx("p",{children:"5. 定义函数的时候，不支持自定义参数，参数只能是从右侧选择的变量或者表单对象，系统会自动解析。"}),e.jsxs("p",{children:["6. 表格自定义渲染时，需要手工定义渲染函数：function render(text, record, index) ","{ return text; }"]})]}),children:e.jsx(Y,{style:{marginLeft:10,cursor:"pointer"}})}),e.jsx(j,{type:"link",onClick:()=>b("boolean"),children:"布尔值"}),e.jsx(j,{type:"link",onClick:()=>b("expression"),children:"三元表达式模板"}),e.jsx(j,{type:"link",onClick:()=>b("function"),children:"函数模板"}),e.jsx(j,{type:"link",onClick:()=>b("table"),children:"表格自定义渲染模板"})]}),e.jsx("div",{className:u.formula,children:e.jsx(V,{form:s,children:e.jsx(V.Item,{noStyle:!0,name:"expression",children:e.jsx(T,{height:"440px",language:"javascript"})})})})]}),e.jsxs("div",{className:u.variable,children:[e.jsx("div",{className:u.title,children:"参数和变量"}),e.jsx(H,{showLine:!0,defaultExpandAll:!0,switcherIcon:e.jsx(U,{}),fieldNames:{title:"name",key:"id",children:"elements"},treeData:$,onSelect:S})]})]})]})},ee=G(Q(Z)),te=window.icons.FunctionOutlined,ne=window.antd.Input,se=window.React.useRef,ae=({value:d,onChange:h,...y})=>{const m=se();function s(c){var p;h({type:"static",value:(p=c==null?void 0:c.target)==null?void 0:p.value})}function w(c){h({type:"variable",...c})}const i=typeof d=="string"||typeof d=="number"?{type:"static",value:d}:d;return e.jsxs(e.Fragment,{children:[e.jsx(ne,{readOnly:(i==null?void 0:i.type)==="variable"&&i.value,allowClear:!0,value:i==null?void 0:i.value,onChange:s,addonAfter:e.jsx(te,{onClick:()=>{var c;(c=m.current)==null||c.open(i==null?void 0:i.value)},style:{color:(d==null?void 0:d.type)==="variable"?"#7D33FF":""}}),placeholder:"请选择变量",...y}),e.jsx(ee,{ref:m,onSelect:w})]})};export{ae as V};
